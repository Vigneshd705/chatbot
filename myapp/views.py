import os
import google.generativeai as genai
from django.http import HttpResponse
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
import json

# genai.configure(api_key="AIzaSyDofgXoi-rjZwQGl2uaFvOKTe6A1UUo_eo")
 genai.configure(api_key="AIzaSyBOlAvcqOF9GlcKfAa3KhoiCutysiictmc")


# Create the model
generation_config = {
  "temperature": 1,
  "top_p": 0.95,
  "top_k": 40,
  "max_output_tokens": 8192,
  "response_mime_type": "text/plain",
}

model = genai.GenerativeModel(
  model_name="gemini-1.5-flash",
  generation_config=generation_config,
)

chat_session = model.start_chat(
  history=[
    {
      "role": "user",
      "parts": [
        "\"The FairPlay Anti-Doping App is designed to educate and inform athletes, coaches, and support staff about anti-doping practices, including the consequences of doping, prohibited substances, testing procedures, and more. The app aims to provide accessible, accurate, and up-to-date information to help users stay compliant with anti-doping regulations, make informed decisions, and reduce the risk of inadvertent doping violations.\" for this application i am creating the chatbot\n",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Here are some ideas for a chatbot for the FairPlay Anti-Doping App, categorized by function and example interactions:\n\n**I. Information Retrieval:**\n\n* **Function:** Answering user questions about anti-doping rules, substances, testing, and consequences.\n\n* **Example Interactions:**\n    * **User:** \"What are the consequences of a positive doping test?\"\n    * **Chatbot:** \"The consequences vary depending on the substance, the athlete's history, and the governing body's rules.  They can range from a warning and suspension to a lifetime ban from competition.  For specific details, please provide the substance and governing body.\"\n    * **User:** \"Is caffeine banned?\"\n    * **Chatbot:** \"Caffeine is not generally banned, however, there are limits on the amount permitted in competition.  The specific limits depend on the governing body.  It's always best to check the specific regulations for your sport.\"\n    * **User:** \"What is the WADA prohibited list?\"\n    * **Chatbot:** \"The World Anti-Doping Agency (WADA) Prohibited List is a comprehensive document detailing substances and methods prohibited in sport. You can find the most up-to-date version on the WADA website [link to WADA website].\"\n    * **User:** \"What happens during a doping control?\"\n    * **Chatbot:** \"The doping control process generally involves identification, sample collection (urine and/or blood), and sample sealing. We have a detailed guide on this process within the app. Would you like me to direct you to it?\"\n\n**II. Personalized Guidance:**\n\n* **Function:** Offering personalized advice based on the user's sport, level of competition, and other relevant factors.  This requires user profile information.\n\n* **Example Interactions:**\n    * **Chatbot:** \"To provide you with the most relevant information, could you tell me your sport and competition level?\"\n    * **User:** \"I'm a collegiate track runner.\"\n    * **Chatbot:** \"Great!  Based on your profile, here are some key things to watch out for regarding prohibited substances in track and field‚Ä¶\"  (Provides relevant information)\n    * **User:** \"I'm unsure if a supplement I'm taking is permitted.\"\n    * **Chatbot:** \"Please provide the name of the supplement and its ingredients. I can check against the prohibited list.  However, remember that this is not a definitive answer, and it's always best to consult with a qualified professional.\"\n\n\n**III. Risk Assessment & Prevention:**\n\n* **Function:** Helping users assess their risk of inadvertent doping and providing preventative measures.\n\n* **Example Interactions:**\n    * **Chatbot:** \"Do you take any supplements or medications?\"\n    * **User:** \"Yes, I take a multivitamin.\"\n    * **Chatbot:** \"While many multivitamins are safe, it's important to check the ingredients against the prohibited list.  Do you have the ingredient list available?\"\n    * **User:** \"I'm not sure what to look for on the label.\"\n    * **Chatbot:** \"Here's a helpful guide on how to interpret supplement labels and identify potential risks‚Ä¶\" (Provides link or information).\n\n\n**IV. Resources & Support:**\n\n* **Function:** Directing users to relevant resources, such as contact information for anti-doping organizations, educational materials, and FAQs.\n\n* **Example Interactions:**\n    * **User:** \"Who can I contact if I have more questions?\"\n    * **Chatbot:** \"You can contact your National Anti-Doping Organization (NADO) ‚Äì  here's a link to find your local NADO [link].  You can also access further information and frequently asked questions within the app.\"\n\n**Key Considerations for Development:**\n\n* **Accuracy:**  The chatbot MUST provide accurate and up-to-date information.  Regular updates are crucial.\n* **Disclaimer:**  Include a clear disclaimer stating that the chatbot is for informational purposes only and does not replace professional advice.\n* **User Experience:**  Keep the interface simple and intuitive.\n* **Multilingual Support:**  Consider supporting multiple languages.\n* **Accessibility:**  Ensure the chatbot is accessible to users with disabilities.\n\n\nThis comprehensive approach will create a helpful and informative chatbot for the FairPlay Anti-Doping App.  Remember to regularly review and update the chatbot's knowledge base to ensure accuracy and relevance.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "the chatbot should reply the users carefully it should handle the sensitive information properly and it should greet the user while starting the coversation. it should place emojis if possible and the answers should be breif and it should be elaborate if needed by the user \n",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Okay, here's a refined approach to the chatbot design incorporating your requirements for careful replies, sensitive information handling, greetings, emojis, brevity, and the option for elaboration:\n\n\n**I. Greeting and Initial Interaction:**\n\n* **Chatbot:** \"üëã Hello! Welcome to the FairPlay Anti-Doping App Chatbot.  I'm here to help you understand anti-doping rules and regulations.  How can I assist you today?\"\n\n\n**II. Information Retrieval & Sensitive Information Handling:**\n\n*  The chatbot should avoid directly asking for Personally Identifiable Information (PII) unless absolutely necessary (e.g., for personalized guidance). Instead, it should phrase questions carefully.\n\n* **Example Interactions:**\n    * **User:** \"What's the penalty for using a banned substance?\"\n    * **Chatbot:** \"The penalties for doping violations vary significantly depending on several factors. ‚öñÔ∏è  Could you tell me the specific substance involved (without revealing your personal details, if possible) and the governing body involved?  This will help me provide a more accurate answer. Alternatively, you can explore general information about doping penalties in the app's resources.\"\n    * **User:** \"Is [Specific Supplement Name] allowed?\"\n    * **Chatbot:** \"I cannot definitively say whether a specific supplement is allowed without knowing the complete ingredient list. ü§î  It's crucial to always check with your governing body or a qualified sports physician for accurate information.  I recommend using the app's supplement checker tool, if available, or searching the WADA prohibited list directly.\"\n    * **User:** \"I think I accidentally took a banned substance. What should I do?\"\n    * **Chatbot:** \"This is a serious matter. üö® Please immediately contact your coach, team physician, or your National Anti-Doping Organisation (NADO).  Do not delay seeking help.  I can provide links to relevant resources if you would like.\"\n\n\n**III.  Brevity and Elaboration:**\n\n* **Chatbot:**  Use concise answers initially, followed by an offer for elaboration.\n\n* **Example:**\n    * **User:** \"What is the WADA Prohibited List?\"\n    * **Chatbot:** \"The WADA Prohibited List is a comprehensive document outlining substances and methods banned in sports. üìÑ  Would you like a brief overview or a more detailed explanation?\"\n    * **If User says \"brief overview\":**  \"It lists substances categorized by class (e.g., stimulants, anabolic agents) and prohibited methods.  The full list is available on the WADA website [link].\"\n    * **If User says \"detailed explanation\":**  \"The list is updated annually and is organized into different sections, including prohibited substances, prohibited methods, and specific sport-related restrictions. It considers the type of substance, its metabolites, and the context of use.  The list is complex; reviewing it requires careful attention.  Would you like me to guide you through specific sections?\"\n\n\n**IV. Emojis:**\n\n* Use emojis judiciously ‚Äì they can add visual appeal but avoid overusing them.  Stick to emojis that convey a clear, relevant meaning.\n\n\n**V.  Error Handling:**\n\n* **Chatbot:** \"I'm sorry, I didn't understand your question. ü§î Could you please rephrase it?\"  Or  \"I don't have the information you're requesting.  Perhaps you can search the app's knowledge base.\"\n\n\n\n**VI.  Additional Features:**\n\n* **Progress Tracking:** If users are working through educational modules, the chatbot can track their progress and provide encouragement.\n* **Quizzes:**  Short quizzes can reinforce learning and test understanding.\n* **Direct Links:**  Provide direct links to relevant sections within the app or external websites.\n\n\nRemember that the chatbot's success depends heavily on the quality of its underlying knowledge base and the algorithms that govern its responses.  Regular updates and testing are crucial to ensure accuracy and effectiveness.  Thorough testing and quality assurance should be implemented to check for potential bias or inappropriate responses.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "it should give info about only the application and general details about doping, and this related filelds like sports and anti-doping associations like WADA",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Okay, focusing the chatbot's responses to only the app's features, general doping information, related fields like sports, and anti-doping associations like WADA, here's a revised approach:\n\n\n**I. Greeting:**\n\n* **Chatbot:** \"üëã Hello! Welcome to the FairPlay Anti-Doping App Chatbot. I can help you navigate the app and provide information on anti-doping topics.  How can I assist you today?\"\n\n\n**II. App-Specific Information:**\n\n* **Example Interactions:**\n    * **User:** \"What features does this app have?\"\n    * **Chatbot:** \"The FairPlay app offers educational modules on anti-doping rules, a supplement checker (if applicable), a glossary of terms, and a Q&A section.  It also provides access to relevant resources and links to key organizations like WADA.  Is there a specific feature you'd like to know more about?\"\n    * **User:** \"How do I use the supplement checker?\"\n    * **Chatbot:** \"The supplement checker allows you to input the name and ingredients of a supplement and will check it against the WADA prohibited list (if available).  Remember, it's not a definitive tool, and always consult a medical professional for personalized advice.  Would you like a step-by-step guide?\"\n\n\n**III. General Doping Information:**\n\n* **Example Interactions:**\n    * **User:** \"What is doping?\"\n    * **Chatbot:** \"Doping is the use of banned substances or methods to enhance athletic performance.  It's against the rules and can have serious health consequences.  Do you want more detail on the types of banned substances or methods?\"\n    * **User:** \"What are the consequences of doping?\"\n    * **Chatbot:** \"Consequences can range from warnings and suspensions to lifetime bans from competition, along with potential fines and reputational damage.  The severity depends on the substance, the athlete's history, and the governing body's rules. Would you like to know more about specific penalties?\"\n\n\n**IV. Sports and Anti-Doping Associations:**\n\n* **Example Interactions:**\n    * **User:** \"What is WADA?\"\n    * **Chatbot:** \"WADA (World Anti-Doping Agency) is the global leader in the fight against doping in sport. They develop and monitor the World Anti-Doping Code, the internationally harmonized standards for doping control.  Would you like to visit their website?\" (provide link)\n    * **User:** \"How does anti-doping work in professional sports?\"\n    * **Chatbot:** \"Professional sports organizations generally have strict anti-doping rules and testing programs.  These programs involve regular testing, including urine and blood samples, to detect banned substances.  Specific rules and procedures vary by sport and governing body.  Would you like to learn about the anti-doping process in a specific sport?\"\n\n\n**V.  Error Handling and Unknown Queries:**\n\n* **Chatbot:**  \"I'm sorry, I don't have information on that topic yet.  I'm still under development.  You may find relevant information on the WADA website [link] or by exploring the app's resources.\"\n\n\n**VI.  Keeping it Concise:**\n\nRemember to keep answers concise initially and offer more detail only if the user requests it. Use clear and simple language, avoiding technical jargon unless the user demonstrates understanding.\n\n\nThis revised approach ensures the chatbot remains focused on the app's functionality and relevant external information while avoiding sensitive questions or providing medical advice.  Remember, proper testing and regular updates to the knowledge base are crucial for accuracy and usefulness.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "https://www.wada-ama.org/en this is the WADA website url the bot should give this url for the users if they wanted to see the list of banned components and the model also list some components\n",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Okay, here's an updated chatbot design incorporating the WADA website URL and a list of example banned substances, while emphasizing that this list is not exhaustive and should not be considered definitive advice.\n\n**I. Greeting and Introduction:**\n\n* **Chatbot:** \"üëã Hello! Welcome to the FairPlay Anti-Doping App Chatbot. I can provide information on anti-doping rules, the app's features, and relevant organizations like WADA. How can I assist you today?\"\n\n\n**II.  WADA and Prohibited Substances:**\n\n* **Example Interactions:**\n    * **User:** \"What are some banned substances?\"\n    * **Chatbot:** \"Many substances are prohibited in sport.  The complete list is extensive and changes annually.  For the most up-to-date information, please refer to the World Anti-Doping Agency (WADA) website: [https://www.wada-ama.org/en](https://www.wada-ama.org/en).  However, some examples of substance classes commonly prohibited include:\n        * **Anabolic Steroids:**  These artificially boost muscle growth and strength.\n        * **Peptide Hormones, Growth Factors, Related Substances:**  This includes substances like erythropoietin (EPO), which increases red blood cell production.\n        * **Beta-2 Agonists:**  These are used to treat asthma but can also enhance performance and are often restricted.\n        * **Stimulants:**  These substances increase alertness and energy levels.  Examples include amphetamines and cocaine.\n        * **Narcotics:** These are pain relievers with addictive properties.\n        * **Cannabinoids:** These are components of cannabis (marijuana).\n        * **Diuretics and Masking Agents:** These attempt to mask the presence of other prohibited substances.\n\n        This is not an exhaustive list.  The specific substances and their permitted levels vary depending on the sport and governing body. Always check the official WADA Prohibited List for the most accurate and complete information.\"\n\n    * **User:** \"Where can I see the full list of banned substances?\"\n    * **Chatbot:** \"The complete and up-to-date list of prohibited substances and methods is available on the WADA website: [https://www.wada-ama.org/en](https://www.wada-ama.org/en).  I strongly recommend reviewing it carefully.  The list is quite detailed and contains important information about prohibited substances, methods, and specific requirements for various sports.\"\n\n\n**III.  App Features and Other Information (as before):**\n\n(Maintain the sections on app features, general doping information, and other anti-doping associations as in the previous response.)\n\n\n**IV.  Disclaimer:**\n\nIt's crucial to include a strong disclaimer at the beginning or end of the interaction, possibly even multiple times throughout, to emphasize that the chatbot's information is for educational purposes only and does not constitute medical or legal advice.  For example:\n\n\n**Disclaimer:**  \"The information provided by this chatbot is for educational purposes only and should not be considered a substitute for professional medical, legal, or anti-doping advice.  Always consult with qualified professionals for personalized guidance.\"\n\n\nBy clearly linking to the WADA website and providing a list of examples (with a strong disclaimer), the chatbot fulfills the requirements while remaining responsible and accurate. Remember to keep the knowledge base updated to reflect any changes in the WADA Prohibited List.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "the chatbot should able to reply all the questions related to the doping it should not reply any negative answers like i don't have any info it should try to give answer for all the questions\n",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Designing a chatbot that attempts to answer *all* questions about doping is extremely challenging and potentially risky.  The field is complex, constantly evolving, and nuanced.  Providing incorrect or incomplete information could be harmful.\n\nHowever, we can significantly improve the chatbot's ability to handle a wider range of doping-related questions by incorporating these strategies:\n\n**1. Enhanced Knowledge Base:**\n\n* **Structured Data:** Organize the knowledge base using a structured format (e.g., a knowledge graph) to facilitate more sophisticated question answering.  This allows for better understanding of relationships between concepts (e.g., substances, classes of substances, consequences, testing methods).\n* **Regular Updates:**  Implement a robust system for updating the knowledge base with the latest information from WADA, national anti-doping organizations, and reputable scientific sources.\n* **Broader Scope:**  Include information on various aspects of doping, such as:\n    * Different types of banned substances and their effects.\n    * Doping control procedures and testing methods.\n    * The legal and ethical implications of doping.\n    * Therapeutic Use Exemptions (TUEs).\n    * The role of various anti-doping organizations (WADA, national ADOs).\n    * Resources for athletes, coaches, and support staff.\n    * Information on inadvertent doping and how to avoid it.\n* **Synonyms and Variations:** The chatbot needs to recognize variations in how users might phrase the same question (e.g., \"What are prohibited substances?\" vs. \"What drugs are banned?\").\n\n**2. Improved Question Answering Techniques:**\n\n* **Natural Language Processing (NLP):** Utilize advanced NLP techniques to better understand the intent and context of user questions. This includes handling complex sentence structures, negations, and ambiguities.\n* **Semantic Search:** Implement semantic search capabilities to find relevant information even if the user's query doesn't exactly match the terminology used in the knowledge base.\n* **Knowledge Graph Reasoning:** Use the knowledge graph to infer answers to questions that are not explicitly stated in the knowledge base. For example, if the user asks about a specific substance, the chatbot could infer its class and provide information on that class of substances.\n* **Fallback Mechanisms:**  While avoiding \"I don't know\" responses, if the chatbot cannot definitively answer a question, it should employ strategies like:\n    * Providing a qualified response:  \"While I don't have specific data on that substance, substances in that class generally carry these penalties...\"\n    * Suggesting related information: \"I don't have a direct answer, but you may find this information on the WADA website helpful...\"\n    * Directing the user to further resources: \"That's a complex question.  It's best to consult with your NADO or a qualified sports physician.\"\n\n\n**3. Disclaimer and Caveats:**\n\n* **Repeated Disclaimer:**  Reinforce the disclaimer throughout the interaction to emphasize that the chatbot is an informational resource and not a substitute for professional advice.\n* **Uncertainty Handling:**  If the chatbot is uncertain about an answer, it should explicitly state its uncertainty and direct the user to reliable sources.\n\n\n**Important Ethical Considerations:**\n\n* **Accuracy is paramount:**  Providing inaccurate information about doping can have serious consequences.  Thorough testing and quality assurance are vital.\n* **Avoid giving medical advice:**  The chatbot should never provide medical advice.  It should always refer users to qualified healthcare professionals for personalized guidance.\n* **Legal Considerations:**  Consult with legal experts to ensure that the chatbot's responses comply with all relevant laws and regulations.\n\n\nBy implementing these enhancements, the chatbot can provide more comprehensive and helpful answers to doping-related questions while maintaining accuracy and ethical responsibility.  However, completely eliminating the need for \"I don't know\" or similar responses is likely impossible, given the complexity and constant evolution of the field.  The goal should be to minimize such responses and provide useful alternatives when a definitive answer isn't available.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "Target Audience:\nAthletes: Professional and amateur athletes across various sports who want to stay informed about doping rules and regulations.\nCoaches: Sports coaches who need to educate and guide their athletes on safe and compliant practices.\nSupport Staff: Medical staff, nutritionists, and trainers involved in sports who must ensure the substances they recommend are safe and legal under anti-doping regulations. for our application",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Understanding your target audience‚Äîathletes, coaches, and support staff‚Äîallows us to tailor the chatbot's responses and features to meet their specific needs. Here's how we can adapt the chatbot:\n\n\n**I.  Tailored Greetings and Initial Interactions:**\n\nInstead of a generic greeting, personalize the initial interaction based on the user's self-identified role:\n\n\n* **Athlete (Professional/Amateur):** \"üëã Hello! Welcome to the FairPlay Anti-Doping App Chatbot.  As an athlete, you need to be aware of the rules. How can I help you understand anti-doping regulations and ensure you compete clean?\"\n* **Coach:** \"Hello! Welcome to the FairPlay Anti-Doping App Chatbot.  As a coach, you play a vital role in guiding your athletes. How can I assist you in educating your team about anti-doping rules and maintaining a clean sports environment?\"\n* **Support Staff (Medical/Nutrition/Training):** \"Hello! Welcome to the FairPlay Anti-Doping App Chatbot.  Your role is critical in ensuring athlete well-being and compliance.  How can I help you understand anti-doping regulations and make informed decisions regarding athlete care?\"\n\n\n**II.  Role-Specific Information and Features:**\n\n* **Athletes:**\n    * Focus on clear explanations of the rules, consequences of violations, and resources for finding information about specific substances or supplements.\n    * Include information on Therapeutic Use Exemptions (TUEs) and the process for applying for one.\n    * Provide links to relevant governing bodies for their specific sport.\n    * Offer tips on avoiding inadvertent doping.\n\n* **Coaches:**\n    * Offer resources and materials for educating athletes about anti-doping rules.\n    * Provide guidance on how to create a culture of compliance within their teams.\n    * Offer information on best practices for managing athletes' health and nutrition while adhering to anti-doping regulations.\n    * Include information on how to deal with suspected doping violations.\n\n* **Support Staff:**\n    * Focus on resources related to safe supplementation, drug interactions, and relevant regulations for recommending substances.\n    * Provide information about the legal and ethical implications of their recommendations.\n    * Offer guidance on identifying potential risks and alerting athletes to potential violations.\n    * Include information about WADA's prohibited list and how to interpret it effectively.\n\n\n**III.  Improved Question Handling:**\n\nThe chatbot should be designed to understand the context of the question based on the user's role. For example:\n\n\n* **Athlete:** \"Is creatine allowed?\"  The chatbot would provide a specific answer related to creatine's status in the athlete's particular sport and governing body.\n* **Coach:** \"How do I talk to my athletes about supplements?\"  The chatbot would offer resources and strategies for communicating anti-doping information to athletes.\n* **Support Staff:** \"What are the implications of prescribing this medication?\"  The chatbot would focus on the legal and ethical implications within the context of anti-doping rules.\n\n\n**IV.  App Integration:**\n\nThe chatbot should seamlessly integrate with other app features. For example:\n\n\n*  Link directly to relevant sections within the app (e.g., supplement checker, educational modules, resource library).\n* Allow users to save important information for later reference.\n* Track user progress through educational modules.\n\n\nBy incorporating these role-specific adjustments and features, the FairPlay chatbot will provide a more personalized and valuable experience for all its users.  This targeted approach increases the chatbot's effectiveness and relevance, making it a crucial resource for maintaining fair play in sports.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "Key Features of the Application:\nVideo-Based Learning Modules:\nEducational content divided into categories like Athlete Awareness and Methods, Detection, and Enforcement. Modules include:\nIntroduction to Anti-Doping\nConsequences of Doping\nProhibited Substances and Methods\nTherapeutic Use Exemptions (TUE)\nNutrition and Supplements Awareness\nPsychological and Social Aspects of Doping\nDoping Control Officers and Roles\nTechnology in Anti-Doping\nEmerging Trends in Doping and Detection\nProhibited Substances Search:\nUsers can search for any substance or medication to see if it‚Äôs on the World Anti-Doping Agency (WADA) Prohibited List.\nRisk Assessment Tool:\nA tool to help athletes assess the potential risks of substances or supplements they use by checking for banned ingredients or methods.\nNews & Updates:\nA section dedicated to the latest updates on anti-doping regulations, policies, and any changes in the WADA prohibited list.\nFAQs & Knowledge Base:\nA comprehensive collection of frequently asked questions, providing clear and concise answers to help users understand common anti-doping issues.",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Here's how the chatbot can integrate with and enhance the key features of your FairPlay Anti-Doping app:\n\n\n**I. Video-Based Learning Modules:**\n\n* **Navigation and Guidance:** The chatbot can help users navigate the video modules.  A user could ask, \"What modules are available on prohibited substances?\", and the chatbot would list the relevant videos with brief descriptions.\n* **Content Summarization:** After a user watches a module, the chatbot could ask, \"Did you find that video helpful?  Would you like a quick summary of the key takeaways?\"  This reinforces learning.\n* **Quizzes and Assessments:** The chatbot can administer short quizzes after each module to test comprehension and provide feedback.  It could say, \"Let's test your understanding.  Here are a few questions about the 'Consequences of Doping' module.\"\n\n\n**II. Prohibited Substances Search:**\n\n* **Enhanced Search:** The chatbot can assist users in effectively searching the prohibited substance database.  It could clarify search terms or suggest related substances if the initial search yields no results. For example, if a user searches for \"creatine,\" it might ask for clarification on the specific form or brand and then provide a more nuanced response.\n* **Interpreting Results:** The chatbot could help users interpret the search results, explaining the meaning of different classifications and providing context.  For example, it could explain the difference between a substance being completely prohibited versus having permitted thresholds.\n\n\n**III. Risk Assessment Tool:**\n\n* **Guidance and Interpretation:** The chatbot can guide users through the risk assessment tool, explaining how to input information and interpret the results.  It could offer additional advice or suggest further investigation based on the assessment.\n* **Follow-up Questions:** After a user completes a risk assessment, the chatbot could ask follow-up questions to ensure the user understands the implications of the results and knows what steps to take next.\n\n\n**IV. News & Updates:**\n\n* **Summarization and Alerting:** The chatbot could provide summaries of new anti-doping regulations and WADA updates. It could also offer to send alerts when significant changes occur.  For example: \"There have been recent updates to the WADA Prohibited List. Would you like a summary of the key changes?\"\n* **Personalized Updates:** Based on a user's sport or role, the chatbot could provide more relevant news and updates.\n\n\n**V. FAQs & Knowledge Base:**\n\n* **Improved Search:** The chatbot could act as an intelligent search engine for the FAQs and knowledge base, providing more accurate and relevant results. It could understand synonyms and related concepts to find the best answer.\n* **Handling Unanswered Questions:** If the chatbot can't find a direct answer in the FAQ section, it can guide the user towards other resources or suggest contacting a human expert.\n\n\n**VI. Overall Chatbot Functionality Enhancements:**\n\n* **Multi-lingual Support:**  Support different languages to cater to a wider range of athletes and staff.\n* **User Profiles:**  Allow users to create profiles to personalize the information they receive and track their progress.\n* **Contextual Awareness:** Maintain a conversation history to avoid repeating information and provide consistent and relevant responses.\n\n\nBy integrating the chatbot with all these app features, you create a powerful tool that enhances user engagement, improves understanding of anti-doping rules, and promotes fair play in sports.  Remember to prioritize accuracy and clarity in all responses and include disclaimers where appropriate.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "User Expectations from the Chatbot:\nAnswering Questions: The chatbot should be able to respond to questions about anti-doping regulations, prohibited substances, and other related topics.\nExample: \"Is caffeine allowed in sports?\" or \"What is the TUE process?\"\nGuiding Users Through Features: It should guide users through different app features, such as helping them navigate to learning modules or providing links to the prohibited substances search tool.\nExample: \"You can find out more about the consequences of doping in the Athlete Awareness module.\"\nProviding Quick Facts: The chatbot should be able to offer quick, accurate responses based on up-to-date anti-doping information, especially in high-priority areas such as banned substances.\nExample: \"Caffeine is not banned outright, but it has limits in certain sports. Would you like to know the exact permissible amount?\"\n",
      ],
    },
    {
      "role": "model",
      "parts": [
        "Let's design chatbot responses to meet these user expectations:\n\n**I. Answering Questions:**\n\n* **Example 1: \"Is caffeine allowed in sports?\"**\n\n    * **Chatbot Response:** \"Caffeine is permitted in many sports, but its levels are regulated.  The specific limits vary by sport and competition.  To be certain about the allowed amount in your specific sport and competition, you should check the current WADA Prohibited List and the regulations of your governing body.  Would you like me to provide a link to the WADA website or your sport's governing body's site?\"\n\n* **Example 2: \"What is the TUE process?\"**\n\n    * **Chatbot Response:** \"The Therapeutic Use Exemption (TUE) process allows athletes with a legitimate medical need for a prohibited substance to obtain an exemption.  It involves submitting a detailed application to your national anti-doping organization (NADO), including medical documentation supporting the need.  The process is rigorous and requires specific criteria to be met. To learn more about the steps and requirements for applying for a TUE, would you like me to direct you to the relevant section in the app's learning modules or the WADA website?\"\n\n* **Handling Complex Questions:** For complex questions requiring nuanced answers, the chatbot can provide a summary and then offer additional resources:\n\n    * **Chatbot Response (General):** \"That's a complex issue.  Here's a brief overview: [brief answer]. For a complete understanding and the most up-to-date information, please review [relevant section in app] or consult [relevant resource, e.g., WADA website].\"\n\n\n**II. Guiding Users Through Features:**\n\n* **Example:** \"I want to learn more about the consequences of doping.\"\n\n    * **Chatbot Response:** \"Certainly!  The 'Consequences of Doping' module provides detailed information on the potential penalties for doping violations.  I can direct you to that module now. Would you like me to open it for you?\" (This assumes the app allows the chatbot to directly interact with the app's interface.)  Alternatively: \"You can find that information in the 'Athlete Awareness' section, under the 'Consequences of Doping' module.  You can access the module directly through the app's main menu.\"\n\n\n**III. Providing Quick Facts:**\n\n* **Example: \"What are some common stimulants on the banned list?\"**\n\n    * **Chatbot Response:** \"Several stimulants are prohibited.  Common examples include amphetamines and cocaine.  It's crucial to note that this is not an exhaustive list and the full list of prohibited substances is available on the WADA website [link].  Would you like me to provide a link directly to the WADA Prohibited List?\"  (This emphasizes the limitations of the chatbot's knowledge and points to the authoritative source).\n\n* **Handling Uncertainties:** If the chatbot doesn't have immediate access to a precise piece of information, it needs to manage that gracefully:\n\n    * **Chatbot Response (General):** \"I'm currently accessing that information.  In the meantime, here's what I know about related topics: [relevant related info]. I'll update you with the specific answer as soon as I can.\"  Or: \"I don't have that specific information immediately available.  However, the app's search function should help you find the latest details on [topic]. Would you like me to show you how to use the app's search function?\"\n\n\n\n**Key Design Considerations:**\n\n* **Clear and Concise Language:** Avoid jargon and use plain language that is easily understood by the target audience.\n* **Multiple Response Options:** Offer users choices or options to further refine their queries and access the most relevant information.\n* **Error Handling:**  Implement robust error handling to gracefully manage situations where the chatbot cannot provide an answer.  Instead of saying \"I don't know,\" offer suggestions for finding the information elsewhere.\n* **Regular Updates:** Keep the chatbot's knowledge base consistently updated with the latest information from WADA and other relevant sources.\n\n\nBy following these guidelines, you can build a chatbot that effectively meets user expectations and enhances the overall user experience of the FairPlay Anti-Doping app.\n",
      ],
    },
    {
      "role": "user",
      "parts": [
        "Tone and Language Expectations:\nThe chatbot should respond in a professional, informative, and neutral tone.\nIt should aim for clarity and simplicity in its responses, avoiding jargon where possible to ensure accessibility for all users, even those unfamiliar with anti-doping terms.",
      ],
    },
    {
      "role": "model",
      "parts": [
        "To ensure the chatbot maintains a professional, informative, and neutral tone while prioritizing clarity and simplicity, consider these guidelines for its language and responses:\n\n**I.  Word Choice and Sentence Structure:**\n\n* **Avoid Jargon and Technical Terms:**  Replace specialized anti-doping terminology with clear, everyday language.  For example, instead of \"exogenous anabolic androgenic steroids,\" use \"artificial substances that boost muscle growth.\"\n* **Define Unfamiliar Terms:** When unavoidable, introduce technical terms and then immediately define them. For instance: \"A Therapeutic Use Exemption (TUE) is a special permission granted to an athlete who needs medication containing a prohibited substance for a legitimate medical reason.\"\n* **Use Active Voice:**  Active voice makes sentences clearer and easier to understand. For instance, use \"The athlete must submit a TUE application\" instead of \"A TUE application must be submitted by the athlete.\"\n* **Short, Concise Sentences:** Favor shorter sentences over long, complex ones.  Break down complex information into smaller, easily digestible chunks.\n* **Simple Language:** Use everyday words and avoid overly formal or academic language.\n\n\n**II.  Tone and Style:**\n\n* **Neutral and Objective:** Maintain a neutral and objective tone, avoiding any emotional or subjective language. Avoid making value judgments or expressing personal opinions.\n* **Professional and Respectful:** Always address users respectfully and professionally.  Use polite phrases like \"Certainly,\" \"I understand,\" and \"I'd be happy to help.\"\n* **Helpful and Supportive:** The chatbot's goal is to help users understand complex information.  Respond in a helpful and supportive manner, avoiding any condescending or dismissive language.\n* **Clear and Direct:** Get straight to the point. Avoid unnecessary embellishments or wordiness.\n\n\n**III.  Handling Uncertainties and Limitations:**\n\n* **Honest and Transparent:**  If the chatbot cannot answer a question, admit it honestly.  Avoid fabricating information or making assumptions.\n* **Offer Alternatives:** Suggest alternative ways to find the information, such as directing the user to relevant resources within the app or on the WADA website.\n* **Phrase Uncertainties Carefully:** If providing partial information, use phrases such as, \"To the best of my knowledge...\" or \"Based on the information available to me...\"\n\n\n**IV. Example Responses Illustrating the Tone:**\n\n* **Instead of:** \"The administration of exogenous substances is strictly prohibited.\"\n* **Use:** \"It's against the rules to take any artificial substance to improve your athletic performance.\"\n\n* **Instead of:** \"The athlete must comply with the stipulated regulations pertaining to sample collection procedures.\"\n* **Use:** \"Athletes need to follow the rules when they give samples for testing.\"\n\n* **Instead of:** \"Pursuant to WADA guidelines, the athlete's medical history will undergo a thorough examination during the TUE application review.\"\n* **Use:** \"Your medical information will be carefully reviewed when you apply for a Therapeutic Use Exemption (TUE).\"\n\n\nBy consistently adhering to these guidelines, the chatbot's language will be clear, accessible, and maintain a consistently professional and helpful tone for all users, regardless of their familiarity with anti-doping regulations.\n",
      ],
    },
  ]
)

@csrf_exempt
def chatbotResponse(request):
    if request.method == 'POST':
        try:
            # Parse the incoming request body as JSON
            body = json.loads(request.body.decode('utf-8'))
            input_text = body.get('message')

            if not input_text:
                return JsonResponse({'error': 'input_text is required'}, status=400)

            response = chat_session.send_message(input_text)
            
            return JsonResponse({'response_text': response.text})
        
        except json.JSONDecodeError:
            return JsonResponse({'error': 'Invalid JSON'}, status=400)
        except Exception as e:
            return JsonResponse({'error': str(e)}, status=500)
    
    return JsonResponse({'error': 'Invalid request method'}, status=405)


def convert_to_json(response_str):
    lines = response_str.strip().split("\n")
    data = []
    for line in lines:
        parts = line.split(",")
        if len(parts) == 3:
            record = {
                "item": parts[0].strip(),    
                "category": parts[1].strip(),    
                "cost": float(parts[2].strip()) 
            }
            data.append(record)
    return data

  